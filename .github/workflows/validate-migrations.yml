name: Validate Migrations (optional)
on:
  pull_request:
    paths:
      - "migrations/**"
      - "infrastructure/**/migrations/**"
permissions:
  contents: read
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Ensure migration files have timestamps & down scripts
        run: |
          fail=0
          shopt -s globstar || true
          for f in migrations/**/*.sql \
              infrastructure/**/migrations/**/*.sql; do
            [ -e "$f" ] || continue
            echo "Checking $f"
            grep -Eq "-- +up" "$f" || \
              { echo "Missing -- up in $f"; fail=1; }
            grep -Eq "-- +down" "$f" || \
              { echo "Missing -- down in $f"; fail=1; }
          done
          exit $fail
